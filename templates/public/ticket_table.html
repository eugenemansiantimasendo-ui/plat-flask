{% extends "plat/base_client.html" %}

{% block title %}
Ticket de Réservation #{{ reservation.id_reservation or 'N/A' }}
{% endblock %}

{% block content %}
<div class="container mt-5 d-flex justify-content-center">
  <div class="card shadow-lg p-4" style="max-width: 400px; width: 100%;">
    <!-- Header -->
    <h2 class="text-success mb-3 text-center">🎟️ Ticket de Réservation</h2>

    <!-- Informations du client -->
    <div class="mb-3">
      <p><strong>Nom :</strong> {{ reservation.nom_client or 'N/A' }} {{ reservation.prenom_client or '' }}</p>
      <p><strong>Email :</strong> {{ reservation.email_client or 'N/A' }}</p>
      <p><strong>Téléphone :</strong> {{ reservation.telephone_client or 'N/A' }}</p>
      <p><strong>Date :</strong> 
        {{ reservation.date_reservation.strftime("%d/%m/%Y") if reservation.date_reservation else 'N/A' }}
      </p>
      <p><strong>Heure :</strong> 
        {{ reservation.heure_reservation.strftime("%H:%M") if reservation.heure_reservation else 'N/A' }}
      </p>
      <p><strong>Nombre de personnes :</strong> {{ reservation.nombre_personnes or 'N/A' }}</p>
      <p><strong>Statut :</strong> 
        {% if reservation.status == 'Confirmée' %}
          <span class="badge bg-success">{{ reservation.status }}</span>
        {% elif reservation.status == 'En attente' %}
          <span class="badge bg-warning text-dark">{{ reservation.status }}</span>
        {% else %}
          <span class="badge bg-danger">{{ reservation.status or 'Annulée' }}</span>
        {% endif %}
      </p>
    </div>

    <!-- QR Code -->
    {% if qr_base64 %}
    <div class="text-center my-3">
      <img src="{{ qr_base64 }}" alt="QR Code" width="200" class="img-fluid">
      <p class="text-muted mt-2 mb-0">Présentez ce QR Code à votre arrivée</p>
    </div>
    {% endif %}

    <!-- Actions -->
    <div class="mt-4 d-flex justify-content-center gap-3 flex-wrap">
      <a href="{{ url_for('reservation_public.ticket_pdf', reservation_id=reservation.id_reservation) }}" class="btn btn-outline-primary">
        📥 Télécharger PDF
      </a>
      <button onclick="window.print()" class="btn btn-success">🖨️ Imprimer</button>
    </div>
  </div>
</div>

<!-- Style pour l'impression -->
<style>
@media print {
  body * { visibility: hidden; }
  .card, .card * { visibility: visible; }
  .card { position: absolute; left: 0; top: 0; width: 100%; box-shadow: none; border: none; }
}
</style>
{% endblock %}
